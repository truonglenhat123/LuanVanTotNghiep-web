
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/LayoutAdmin.cshtml";
    var Order = (List<WebsiteBanDienThoai.EF.Order>)ViewBag.Order;
    var OrderDetail = (List<WebsiteBanDienThoai.EF.Oder_Detail>)ViewBag.OrderDetail;

    var culture = System.Globalization.CultureInfo.GetCultureInfo("vi-VN");
    var ListOrderDetail = (List<WebsiteBanDienThoai.EF.Oder_Detail>)ViewBag.ListOrderDetails;
    var ListOrder = (List<WebsiteBanDienThoai.EF.Order>)ViewBag.ListOrder;
    var ListProduct = (List<WebsiteBanDienThoai.EF.Product>)ViewBag.HotProduct;
    DateTime getLastMonth = DateTime.Now.AddMonths(-1);
    double totalOrderThisMonth = Convert.ToDouble(Order.Where(m => m.oder_date.Month == DateTime.Now.Month && m.oder_date.Year == DateTime.Now.Year).Count());
    double totalOrderLastMonth = Convert.ToDouble(Order.Where(m => m.oder_date.Month == getLastMonth.Month).Count());
    double totalPriceOrderThisMonth = Convert.ToDouble(Order.Where(m => m.oder_date.Month == DateTime.Now.Month && m.oder_date.Year == DateTime.Now.Year).Sum(m => m.total));
    double totalPriceOrderLastMonth = Convert.ToDouble(Order.Where(m => m.oder_date.Month == getLastMonth.Month).Sum(m => m.total));
    double percentOrder = ((1) - ((totalOrderLastMonth - totalOrderThisMonth) / (totalOrderLastMonth)));
    double percentPriceOrder = ((1) - ((totalPriceOrderLastMonth - totalPriceOrderThisMonth) / (totalPriceOrderLastMonth)));
    double total = 0;
    double total2 = 0;
}

<div class="main">
    <div class="main-header">
        <div class="mobile-toggle" id="mobile-toggle">
            <i class='bx bx-menu-alt-right'></i>
        </div>
        <div class="main-title">
            Bảng điều khiển
        </div>
    </div>
    <div class="main-content">
        <div class="row">
            <div class="col-3 col-md-6 col-sm-12">
                <div class="box box-hover">
                    <!-- COUNTER -->
                    <div class="counter">
                        <div class="counter-title">
                            Tổng đơn đặt mua
                        </div>
                        <div class="counter-info">
                            <div class="counter-count">
                                @Order.Count()
                            </div>
                            
                            <i class='bx bx-shopping-bag'></i>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-3 col-md-6 col-sm-12">
                <div class="box box-hover">
                    <!-- COUNTER -->
                    <div class="counter">
                        <div class="counter-title">
                            tỉ lệ phản hồi
                        </div>
                        <div class="counter-info">
                            <div class="counter-count">
                                30.5%
                            </div>
                            <i class='bx bx-chat'></i>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-3 col-md-6 col-sm-12">
                <div class="box box-hover">

                    <div class="counter">
                        <div class="counter-title">
                            Tổng lợi nhuận
                        </div>
                        <div class="counter-info">
                            <div class="counter-count">
                                @Order.Sum(m => m.total).ToString("#,0", culture.NumberFormat)
                            </div>
                            <i class='bx bx-line-chart'></i>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-3 col-md-6 col-sm-12">
                <div class="box box-hover">

                    <div class="counter">
                        <div class="counter-title">
                            lưu lượng truy cập ngày
                        </div>
                        <div class="counter-info">
                            <div class="counter-count">
                                690
                            </div>
                            <i class='bx bx-user'></i>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-10 col-md-9 col-sm-12">

                <div class="box f-height">
                    <div class="box-header">
                        Top sản phẩm
                    </div>
                    <div class="box-body">
                        <ul class="product-list">
                            @foreach (var item in ListProduct)
                            {
                                <li class="product-list-item">
                                    <div class="item-info">
                                        <a href="iphone12_view.html">
                                            <img src="~/Assets/img/@item.image" alt="product image">
                                            <div class="item-name">
                                                <div class="product-name">@item.ProductName</div>
                                                <div class="text-second">VN/A</div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="item-sale-info">
                                        <div class="text-second">Giá</div>
                                        <div class="product-sales">@Html.FormatValue(item.New_Price,"{0:c}")</div>
                                    </div>
                                </li>
                            }


                        </ul>
                    </div>
                </div>

            </div>
 

            <div class="col-12">

                <div class="box">
                    <div class="box-header">
                        Đơn hàng gần đây
                    </div>
                    <div class="box-body overflow-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Khách hàng</th>
                                    <th>Ngày</th>
                                    <th>Số điện thoại</th>
                                    <th>Tình trạng thanh toán</th>
                                    <th>Tổng đơn</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ListOrder)
                                {
                                    <tr>
                                        <td>@item.order_id</td>
                                        <td>
                                            <div class="order-owner">
                                                <span>@item.Account.Name</span>
                                            </div>
                                        </td>
                                        <td>@item.create_at</td>
                                        <td>@item.Account.Phone</td>
                                        <td>
                                            @if (item.status == "1")
                                            {

                                                <span class="order-status order-ready">
                                                    Chờ xử lí
                                                </span>

                                            }
                                            else if (item.status == "2")
                                            {
                                                <span class="order-status order-ready">
                                                    Đang xử lí
                                                </span>
                                            }
                                            else if (item.status == "3")
                                            {
                                                <span class="order-status order-ready">
                                                    Hoàn thành
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="order-status order-ready">
                                                    Đã hủy
                                                </span>
                                            }

                                        </td>
                                        <td>@Html.FormatValue(item.total, "{0:c}") ₫</td>
                                    </tr>
                                }


                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

